-- === Anpassungen für LQEF ===
-- config.locked_profile_fields = { realname = true }


-- Name of this instance, defaults to name of config file
-- ------------------------------------------------------------------------
config.instance_name = "Liquid Erfurt"


-- Information about service provider (HTML)
-- ------------------------------------------------------------------------
config.app_service_provider = "Liquid Erfurt e.V.<br/>Am Angerberg 1<br />99084 Erfurt<br /><br />Vertreten durch:<br />Philipp Lehmann"


-- A rocketwiki formatted text the user has to accept while registering
-- ------------------------------------------------------------------------
config.use_terms = "LiquidErfurt ist ein Angebot an alle Bürgerinnen und Bürger der Stadt Erfurt, sich im Internet am Meinungsbildungsprozess des Stadtrats zu beteiligen. Im Interesse aller Nutzer erkennt jeder Teilnehmer diese Regeln an:\n\n\n= 1. Zweck =\nIn LiquidErfurt werden grundsätzlich Themen behandelt, für die die Stadt Erfurt als Kommune zuständig ist.\n\n\n= 2. Organisation =\n- Teilnehmer können Initiativen einbringen und / oder Initiativen, die andere Teilnehmer eingebracht haben, unterstützen und über sie abstimmen. Dabei bietet LiquidErfurt grundsätzlich die Möglichkeit, die eigene Stimme bezogen auf ein einzelnes Thema, einen Themenbereich oder für alle Bereiche auf einen anderen Teilnehmer zu übertragen. Hilfetexte innerhalb der Plattform erläutern die Details.\n- Ausgewählte Vorlagen der Stadtverwaltung werden parallel zur Beratung in den politischen Gremien in LiquidErfurt zur Diskussion gestellt und das entsprechende Ergebnis dem Stadtrat vor der abschließenden Entscheidung als Meinungsbild zur Kenntnis gegeben.\n\n\n= 3. Teilnehmerkreis und Registrierung =\n- Wer LiquidErfurt nutzen will, muss Einwohnerin oder Einwohner der Stadt Erfurt sein.\n- Die Registrierung erfolgt über ein Online-Formular, in dem die Felder Name, Vorname, Strasse, Hausnummer, PLZ, Wohnort, Geburtsdatum einzutragen sind (= Registrierungsdaten). Dauerhaft online gespeichert werden nur die Angaben zu den Feldern Name, Vorname und die später (s.u.) abgefragte E-Mail-Adresse. Angezeigt in LiquidErfurt werden nur die Daten zu Name, Vorname sowie gegebenenfalls freiwillig eingestellte Profilinformationen und Nutzerfotos. Die übrigen Daten dienen der Identifikation und der Teilnehmerkreisprüfung. Sie werden nicht dauerhaft online, aber dauerhaft auf anderen elektronischen Medien gespeichert.\n- Die Identifikation in LiquidErfurt erfolgt mit dem bürgerlichem Namen des jeweiligen Nutzers oder einem frei wählbaren Pseudonym.\n- Da nicht der Eindruck einer (technisch nicht realisierbaren) geheimen Abstimmung entstehen soll, werden die Nutzer gebeten, bürgerliche Namen zu verwenden. Die Verwendung eines frei wählbaren Synonyms ist möglich. Der Erhalt von Delegationen ist jedoch grundsätzlich nur möglich, wenn ein Teilnehmer seinen bürgerlichen Namen verwendet.\n- Möchte der Nutzer wieder ohne bürgerlichen Namen auftreten, so wird ihm dies von der Administration ermöglicht. Dabei werden ggf. bestehende Delegationen deaktiviert.\n- Nach abgeschlossener Registrierung erhält der Nutzer einen Brief mit einem automatisch generierten Zugangscode.\n- Der Nutzer kann anschließend mit Hilfe des Zugangscodes und eines frei wählbaren Anmeldenamens (Der Anmeldename wird nicht angezeigt und kann vom Nutzernamen abweichen.), dient nur der Kontosicherheit - angezeigt wird der bürgerliche Name) sowie eines eigenen frei wählbaren Passwortes (= Zugangsdaten) unter Angabe einer gültigen E-Mail-Adresse ein Benutzerkonto anlegen. Anmeldename und verschlüsseltes Passwort für dieses Konto werden gespeichert, ebenso wie gegebenenfalls freiwillig eingestellte Profilinformationen und ein freiwillig eingestelltes Nutzerfoto.\n- Voraussetzung für einen erfolgreichen Abschluss der Anmeldung ist, dass der Nutzer dieser Nutzungsvereinbarung und der Datenschutzerklärung zustimmt.\n- Initiativen mit dem Regelwerk \"Einwohnerantrag\" sind grundsätzlich nur für Teilnehmer ab 14 Jahren zur Abstimmung freigegeben. Dieser Abgleich erfolgt bei der Registrierung. Die von den Nutzern erhobenen Daten werden entsprechend den Richtlinien der Datenschutzgesetze aufbewahrt und dienen ausschließlich zum Abgleich bei der Registrierung und der Verifikation des bürgerlichen Namens.\n- Der Nutzer ist verpflichtet, bei einem Umzug innerhalb oder außerhalb des Stadtgebiets diesen dem Betreiber der Plattform anzuzeigen.\n\n\n= 4. Zugangsdaten =\n- Die Zugangsdaten dürfen nicht weitergegeben werden. Dies soll verhindern, dass Dritte unberechtigt LiquidErfurt nutzen. Sofern das dennoch geschieht und der Nutzer diesen Missbrauch seiner Zugangsdaten zu vertreten hat, haftet er für sämtliche Folgen. Bei einem Missbrauch oder einem entsprechenden Verdacht hat der Nutzer umgehend den Betreiber zu informieren, damit die Zugangsdaten geändert werden können.\n\n\n= 5. Nutzungsrechte für LiquidErfurt =\n- Jeder Nutzer, der Inhalte im System erzeugt (dies können zum Beispiel eigene Initiativen, Änderungsvorschläge oder das Abstimmverhalten sein), räumt allen anderen Nutzern die räumlich und zeitlich unbeschränkte Nutzungsrechte, die notwendig sind, um die Plattform zu betreiben und sie gegebenenfalls nach einem Ende des Betriebs nicht mehr online anzuzeigen.\n- Dies betrifft auch das Recht, die Plattform so zu betreiben, dass Texte (Initativen und Änderungsvorschläge) von Dritten (Nichtnutzern) ohne Registrierung eingesehen werden können, ohne dass hierbei aber die dazugehörigen Nutzernamen oder weitere Daten außerhalb der eingestellten Texte sichtbar werden.\n- Nutzer können die gesamte LiquidErfurt-Datenbank mit Ausnahme der Zugangsdaten der Nutzer und der freiwillig eingestellten Profilinhalte herunterladen und speichern, ausschließlich zu dem Zweck, bei Bedarf deren fehlerfreien Betrieb zu überprüfen.\n\n\n= 6. Allgemeine Regeln =\n- Jeder Nutzer verpflichtet sich, keine in irgendeiner Form rechtswidrigen Inhalte einzustellen oder auf sie zu verlinken oder rechtswidrig in den Programmablauf einzugreifen.\n- LiquidErfurt ist ausschließlich für die private Nutzung zur Meinungsbildung und zur Ausübung von politischen Beteiligungsrechten vorgesehen, eine gewerbliche Nutzung ist nicht gestattet. Eine Ausnahme existiert für Vertreter von Medien, die über die Plattform und ihre Inhalte öffentlich berichten.\n- Fotos, die Nutzer gegebenenfalls in ihr Profil einstellen, dürfen keine anderen Personen als sie selbst zeigen.\n\n\n= 7. Haftung =\n- Der Nutzer erkennt an, dass er für alle seine ins System LiquidErfurt eingestellten Inhalte und Handlungen allein verantwortlich ist.\n- Sollte der Nutzer gegen diese Bestimmungen verstoßen, entbindet er den Betreiber von jeder Haftung und sämtlichen Kosten, die in diesem Zusammenhang entstehen.\n\n\n= 8. Verstöße/Konsequenzen =\n- Der Betreiber kann Inhalte löschen, insbesondere solche, die nach Ziffer 6 unzulässig sind.\n- Der Betreiber kann nach Verstößen gegen diese Nutzungsbedingungen Nutzern ihren Zugang zu LiquidErfurt entziehen. Dies wird dem Nutzer schriftlich mitgeteilt.\n\n\n= 9. Beendigung =\n- Sobald ein Nutzer seinen Erstwohnsitz nicht mehr in der Stadt Erfurt hat, endet die Nutzungsberechtigung automatisch.\n- Jeder Nutzer kann seine Nutzung jederzeit ordentlich kündigen.\n- Eine außerordentliche Kündigung entspricht einem Entzug des Zugangs nach Ziffer 8.\n- Alle Kündigungen bedürfen der Schriftform, eine E-Mail ist hier ausreichend.\n- Wenn die Nutzungsberechtigung endet, werden die Zugangsdaten vollständig gelöscht.\n\n\n= 10. Änderungen =\n- Der Betreiber behält sich vor, diese Nutzungsvereinbarungen zu ändern.\n- In diesem Fall werden die neuen Nutzungsvereinbarungen auf LiquidErfurt bekannt gemacht und per E-Mail an alle Nutzer übermittelt. Wenn der Nutzer nicht innerhalb von 4 Wochen wiederum per E-Mail oder schriftlich widerspricht, gelten sie als vereinbart."


-- Checkbox(es) the user has to accept while registering
-- ------------------------------------------------------------------------
config.use_terms_checkboxes = {
  {
    name = "terms_of_use_v1",
    html = "I accept the terms of use.",
    not_accepted_error = "You have to accept the terms of use to be able to register."
  },
--  {
--    name = "extra_terms_of_use_v1",
--    html = "I accept the extra terms of use.",
--    not_accepted_error = "You have to accept the extra terms of use to be able to register."
--  }
}

  
-- Absolute base url of application
-- ------------------------------------------------------------------------
config.absolute_base_url = "https://lqfb.liquid-erfurt.org/"


-- Connection information for the LiquidFeedback database
-- ------------------------------------------------------------------------
config.database = { engine='postgresql', dbname='liquid_feedback' }


-- Location of the rocketwiki binaries
-- ------------------------------------------------------------------------
config.formatting_engine_executeables = {
  rocketwiki= "/opt/rocketwiki-lqfb/rocketwiki-lqfb",
  compat = "/opt/rocketwiki-lqfb/rocketwiki-lqfb-compat"
}


-- Public access level
-- ------------------------------------------------------------------------
-- Available options:
-- "none" 
--     -> Closed user group, no public access at all
--        (except login/registration/password reset)
-- "anonymous"
--     -> Shows only initiative/suggestions texts and aggregated
--        supporter/voter counts
-- "authors_pseudonymous" 
--     -> Like anonymous, but shows screen names of authors
-- "all_pseudonymous" 
--     -> Show everything a member can see, except profile pages
-- "everything"
--     -> Show everything a member can see, including profile pages
-- ------------------------------------------------------------------------
config.public_access = "anonymous"



-- ========================================================================
-- OPTIONAL
-- Remove leading -- to use a option
-- ========================================================================

-- List of enabled languages, defaults to available languages
-- ------------------------------------------------------------------------
config.enabled_languages = { 'en', 'de' }

-- Default language, defaults to "en"
-- ------------------------------------------------------------------------
config.default_lang = "de"

-- after how long is a user considered inactive and the trustee will see warning,
-- notation is according to postgresql intervals, default: no warning at all
-- ------------------------------------------------------------------------
config.delegation_warning_time = '6 months'

-- Prefix of all automatic mails, defaults to "[Liquid Feedback] "
-- ------------------------------------------------------------------------
config.mail_subject_prefix = "[LiquidErfurt]"

-- Sender of all automatic mails, defaults to system defaults
-- ------------------------------------------------------------------------
config.mail_envelope_from = "liquidfeedback@liquid-erfurt.org"
config.mail_from = { name = "LiquidErfurt", address = "liquidfeedback@liquid-erfurt.org" }
config.mail_reply_to = { name = "LiquidErfurt", address = "liquidfeedback@liquid-erfurt.org" }

-- Configuration of password hashing algorithm (defaults to "crypt_sha512")
-- ------------------------------------------------------------------------
-- config.password_hash_algorithm = "crypt_sha512"
-- config.password_hash_algorithm = "crypt_sha256"
-- config.password_hash_algorithm = "crypt_md5"

-- Number of rounds for crypt_sha* algorithms, minimum and maximum
-- (defaults to minimum 10000 and maximum 20000)
-- ------------------------------------------------------------------------
-- config.password_hash_min_rounds = 10000
-- config.password_hash_max_rounds = 20000


-- Supply custom url for avatar/photo delivery
-- ------------------------------------------------------------------------
config.fastpath_url_func = function(member_id, image_type)
  return request.get_absolute_baseurl() .. "fastpath/getpic?" .. tostring(member_id) .. "+" .. tostring(image_type)
end

-- Local directory for database dumps offered for download
-- ------------------------------------------------------------------------
-- config.download_dir = nil

-- Special use terms for database dump download
-- ------------------------------------------------------------------------
-- config.download_use_terms = "=== Download use terms ===\n"

-- Use custom image conversion, defaults to ImageMagick's convert
-- ------------------------------------------------------------------------
--config.member_image_content_type = "image/jpeg"
--config.member_image_convert_func = {
--  avatar = function(data) return extos.pfilter(data, "convert", "jpeg:-", "-thumbnail",   "48x48", "jpeg:-") end,
--  photo =  function(data) return extos.pfilter(data, "convert", "jpeg:-", "-thumbnail", "240x240", "jpeg:-") end
--}

-- Display a public message of the day
-- ------------------------------------------------------------------------
-- config.motd_public = "===Message of the day===\nThe MOTD is formatted with rocket wiki"

-- Automatic issue related discussion URL
-- ------------------------------------------------------------------------
-- config.issue_discussion_url_func = function(issue)
--   return "http://example.com/discussion/issue_" .. tostring(issue.id)
-- end

-- Integration of Etherpad, disabled by default
-- ------------------------------------------------------------------------
--config.etherpad = {
--  base_url = "http://example.com:9001/",
--  api_base = "http://localhost:9001/",
--  api_key = "mysecretapikey",
--  group_id = "mygroupname",
--  cookie_path = "/"
--}

-- Free timings
-- ------------------------------------------------------------------------
-- This example expects a date string entered in the free timing field
-- by the user creating a poll, interpreting it as target date for then
-- poll and splits the remaining time at the ratio of 4:1:2
-- Please note, polling policies never have an admission phase
-- The available_func is optional, if not set any target date is allowed

config.free_timing = {
  calculate_func = function(policy, timing_string)
    function interval_by_seconds(secs)
      local secs_per_day = 60 * 60 * 24
      local days
      days = math.floor(secs / secs_per_day)
      secs = secs - days * secs_per_day
      return days .. " days " .. secs .. " seconds"
    end
    local target_date = parse.date(timing_string, atom.date)
    if not target_date then
      return false
    end
    local target_timestamp = target_date.midday
    local now = atom.timestamp:get_current()
    trace.debug(target_timestamp, now)
    local duration = target_timestamp - now
    if duration < 0 then
      return false
    end
    return {
      discussion = interval_by_seconds(duration / 7 * 4),
      verification = interval_by_seconds(duration / 7 * 1),
      voting = interval_by_seconds(duration / 7 * 2)
    }
  end,
  available_func = function(policy)
    return { 
      { name = "End of 2013", id = '2013-12-31' },
      { name = "End of 2014", id = '2014-12-31' },
      { name = "End of 2015", id = '2015-12-31' }
    }
  end
}

-- WebMCP accelerator
-- uncomment the following two lines to use C implementations of chosen
-- functions and to disable garbage collection during the request, to
-- increase speed:
-- ------------------------------------------------------------------------
require 'webmcp_accelerator'
if cgi then collectgarbage("stop") end

-- Trace debug
-- uncomment the following line to enable debug trace
--config.enable_debug_trace = true



execute.config("init")
config.app_version = "2.2.2-lqef"
